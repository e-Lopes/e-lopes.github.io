<!doctype html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <!-- Anti-Cache -->
        <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
        <meta http-equiv="Pragma" content="no-cache" />
        <meta http-equiv="Expires" content="0" />

        <title>DigiStats</title>
        <link rel="icon" type="image/png" href="../icons/favicon/favicon.png" />

        <!-- PWA -->
        <link rel="manifest" href="/manifest.json" />
        <meta name="theme-color" content="#667eea" />
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:ital,wght@0,700;0,800;1,700;1,800&display=swap"
        />

        <link rel="stylesheet" href="../styles.css?v=1.2.2" />
        <link rel="stylesheet" href="../styles/components/utilities.css" />
        <link rel="stylesheet" href="../styles/components/states.css" />
    </head>
    <body>
        <div class="container">
            <div class="top-nav">
                <a href="../index.html" class="nav-button">
                    <span>&larr; Back to Dashboard</span>
                </a>
            </div>
            <header>
                <div class="logo-wrapper">
                    <img src="../icons/logo.png" alt="DigiStats" class="header-logo" />
                </div>
                <p class="subtitle">Digimon TCG Tournament Results v1.2.0</p>
            </header>

            <div class="filters">
                <div class="filter-group">
                    <label for="storeFilter">1) Store Name</label>
                    <select id="storeFilter" required>
                        <option value="">Select store...</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="dateFilter">2) Tournament Date</label>
                    <select id="dateFilter" disabled>
                        <option value="">Select a date...</option>
                    </select>
                </div>

                <div class="total-players">
                    <label>TOTAL PLAYERS</label>
                    <div class="total-number" id="totalPlayers">-</div>
                </div>
            </div>

            <!-- Generate post button -->
            <div id="generatePostSection" class="u-text-center u-mb-30 post-generate-panel">
                <button id="generatePostBtn" class="generate-post-btn nav-button" disabled>
                    Generate Post Image
                </button>
            </div>

            <div class="main-content">
                <div class="podium-wrapper">
                    <div class="podium-container">
                        <!-- 1st place -->
                        <div class="podium-card first-place u-hidden" id="firstPlace">
                            <div class="rank-badge gold">
                                <span>1st</span>
                            </div>
                            <div class="deck-card-footer">
                                <div class="player-name"></div>
                                <div class="deck-name">-</div>
                            </div>
                            <div class="card-image-wrapper">
                                <img src="" alt="1st Place" class="deck-card-image" />
                            </div>
                        </div>

                        <!-- 2nd place -->
                        <div class="podium-card second-place u-hidden" id="secondPlace">
                            <div class="rank-badge silver">
                                <span>2nd</span>
                            </div>
                            <div class="deck-card-footer">
                                <div class="player-name"></div>
                                <div class="deck-name">-</div>
                            </div>
                            <div class="card-image-wrapper">
                                <img src="" alt="2nd Place" class="deck-card-image" />
                            </div>
                        </div>

                        <!-- 3rd place -->
                        <div class="podium-card third-place u-hidden" id="thirdPlace">
                            <div class="rank-badge bronze">
                                <span>3rd</span>
                            </div>
                            <div class="deck-card-footer">
                                <div class="player-name"></div>
                                <div class="deck-name">-</div>
                            </div>
                            <div class="card-image-wrapper">
                                <img src="" alt="3rd Place" class="deck-card-image" />
                            </div>
                        </div>

                        <!-- 4th place -->
                        <div class="podium-card fourth-place u-hidden" id="fourthPlace">
                            <div class="rank-badge green">
                                <span>4th</span>
                            </div>
                            <div class="deck-card-footer">
                                <div class="player-name"></div>
                                <div class="deck-name">-</div>
                            </div>
                            <div class="card-image-wrapper">
                                <img src="" alt="4th Place" class="deck-card-image" />
                            </div>
                        </div>
                    </div>
                </div>

                <div class="positions-section">
                    <h2>FULL RESULTS</h2>
                    <div class="positions-grid" id="positionsList"></div>
                </div>
            </div>

            <div class="loading u-hidden" id="loading">
                <div class="spinner"></div>
                <p>Loading tournament data...</p>
            </div>

            <div class="error-message u-hidden" id="errorMessage">
                <p>Error connecting to the database. Check your API key.</p>
            </div>
        </div>

        <!-- Post preview modal -->
        <div id="postPreviewModal" class="modal u-hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <button id="btnPostModalCloseTop" class="modal-close modal-back-btn">
                        <span aria-hidden="true">&larr;</span>
                        <span>Back to Dashboard</span>
                    </button>
                    <div class="preview-title-wrap">
                        <h2>Post Preview</h2>
                        <small>Preview and export</small>
                    </div>
                </div>
                <div class="modal-body">
                    <div id="postPreviewMeta" class="post-preview-meta">Type: Top 4 | Format: -</div>
                    <div id="postCanvasWrap" class="post-canvas-wrap">
                        <canvas id="postCanvas" width="1080" height="1350"></canvas>
                        <div id="postEditorOverlay" class="post-editor-overlay u-hidden"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="sidebar-section sidebar-section-primary">
                        <button id="btnPostDownload" class="btn-download" title="Download (Ctrl/Cmd+S)">
                            Download
                        </button>
                    </div>
                    <div class="sidebar-section">
                        <button type="button" class="sidebar-section-toggle" aria-expanded="true">
                            <span class="sidebar-section-toggle-text">
                                <span class="sidebar-section-title">Post</span>
                                <span class="sidebar-section-hint">Tipo e zoom</span>
                            </span>
                            <span class="sidebar-section-toggle-icon" aria-hidden="true"></span>
                        </button>
                        <div class="sidebar-section-content">
                            <label id="postTypePicker" class="template-object-picker">
                                Post Type
                                <select id="postTypeSelect">
                                    <option value="top4">Top 4</option>
                                    <option value="distribution_results">Deck Distribution + Full Results</option>
                                    <option value="blank_middle">Blank Middle</option>
                                </select>
                            </label>
                            <label class="template-object-picker">
                                Preview Zoom
                                <select id="postPreviewZoomSelect">
                                    <option value="0.6">60%</option>
                                    <option value="0.7">70%</option>
                                    <option value="0.8">80%</option>
                                    <option value="0.9" selected>90%</option>
                                    <option value="1">100%</option>
                                    <option value="1.1">110%</option>
                                </select>
                            </label>
                        </div>
                    </div>
                    <div class="sidebar-section">
                        <button type="button" class="sidebar-section-toggle" aria-expanded="true">
                            <span class="sidebar-section-toggle-text">
                                <span class="sidebar-section-title">Background</span>
                                <span class="sidebar-section-hint">Fundo do formato</span>
                            </span>
                            <span class="sidebar-section-toggle-icon" aria-hidden="true"></span>
                        </button>
                        <div class="sidebar-section-content">
                            <label id="templateBackgroundPicker" class="template-object-picker">
                                Background
                                <select id="templateBackgroundSelect">
                                    <option value="">None</option>
                                    <option value="../icons/backgrounds/EX11.png">EX11</option>
                                </select>
                            </label>
                            <label id="templateBackgroundUploadWrap" class="template-upload-label">
                                New Format Background
                                <input id="templateBackgroundUpload" type="file" accept="image/*" />
                            </label>
                        </div>
                    </div>
                    <div class="sidebar-section sidebar-template-controls" data-template-control>
                        <button type="button" class="sidebar-section-toggle" aria-expanded="true">
                            <span class="sidebar-section-toggle-text">
                                <span class="sidebar-section-title">Template</span>
                                <span class="sidebar-section-hint">Layout e objetos</span>
                            </span>
                            <span class="sidebar-section-toggle-icon" aria-hidden="true"></span>
                        </button>
                        <div class="sidebar-section-content">
                            <label id="templatePresetPicker" class="template-object-picker">
                                Preset
                                <select id="templatePresetSelect">
                                    <option value="">Select preset...</option>
                                </select>
                            </label>
                            <button id="btnSavePreset" class="btn-secondary">Save Preset</button>
                            <button id="btnLoadPreset" class="btn-secondary">Load Preset</button>
                            <button id="btnDeletePreset" class="btn-cancel">Delete Preset</button>
                            <label id="templateObjectPicker" class="template-object-picker">
                                Object
                                <select id="templateObjectSelect">
                                    <option value="logo">Logo</option>
                                    <option value="title">Title/Date</option>
                                    <option value="rows">Podium Border</option>
                                    <option value="trophy">Trophy Icon</option>
                                    <option value="podiumNumber">Podium Number</option>
                                    <option value="avatar">Deck Circle</option>
                                    <option value="rowText">Player/Deck</option>
                                    <option value="distDeckCard">Deck Distribution Card</option>
                                    <option value="distResultsCard">Full Results Card</option>
                                    <option value="distPie">Distribution Pie</option>
                                    <option value="store">Store Logo</option>
                                    <option value="handle">@digimoncwb</option>
                                </select>
                            </label>
                            <label id="templatePieSlicePicker" class="template-object-picker">
                                Pie Slice
                                <select id="templatePieSliceSelect">
                                    <option value="">Select deck...</option>
                                </select>
                            </label>
                            <button id="btnPieEditorToggle" class="btn-secondary">Open Pie Editor</button>
                            <div id="templatePieAdjustRow" class="template-pie-adjust-row">
                                <label>
                                    X
                                    <input id="templatePieXInput" type="number" min="-300" max="300" step="1" />
                                </label>
                                <label>
                                    Y
                                    <input id="templatePieYInput" type="number" min="-300" max="300" step="1" />
                                </label>
                                <label>
                                    Zoom
                                    <input id="templatePieZoomInput" type="number" min="120" max="420" step="1" />
                                </label>
                            </div>
                            <span id="templatePieEditorHint" class="template-help-label u-hidden">Pie Editor: arraste a fatia no grafico e use scroll para zoom.</span>
                            <span class="template-help-label">Move: WASD | Size: &lt; / &gt; | Gap: Q / E (Shift = passo maior)</span>
                            <button id="btnPostTemplateEdit" class="btn-secondary">Edit Template</button>
                            <button id="btnPostTemplateReset" class="btn-cancel">Reset Layout</button>
                        </div>
                    </div>
                    <div class="sidebar-actions">
                        <button id="btnPostModalCloseBottom" class="btn-cancel">Close</button>
                    </div>
                </div>
                <div id="postToast" class="post-toast u-hidden" role="status" aria-live="polite"></div>
            </div>
        </div>

        <script src="../config/supabase.js"></script>
        <script src="../config/api-client.js"></script>
        <script src="../config/ui-state.js"></script>
        <script src="../config/app-version.js"></script>
        <script src="script.js?v=1.2.8"></script>
        <script src="../config/register-sw.js"></script>
    </body>
</html>

